#!/bin/bash

CONFIGURE_SYSTEM=0
while [[ $# -gt 0 ]]; do
  key="$1"
  echo "Key: $key"
  case $key in
    --system)
      CONFIGURE_SYSTEM=1
      ;;
      *)
      ;;
  esac
  shift
done

export current_dir="$(pwd)"

if [ $CONFIGURE_SYSTEM -eq 1 ]; then
  echo "configuring system..."
  ./scripts/configure-system.sh
  cd $current_dir
fi

apt-get --no-install-recommends install -y network-manager
apt-get autoclean
apt-get autoremove -y

pip install git+https://github.com/waggle-sensor/pywaggle
pip3 install git+https://github.com/waggle-sensor/pywaggle

systemctl enable waggle-test.service

ln -s ${current_dir}/scripts/serial/interface.py /usr/local/bin/interface.py

# set script permissions
cd ${current_dir}/scripts
chmod 700 *
chmod 744 test_node.sh
